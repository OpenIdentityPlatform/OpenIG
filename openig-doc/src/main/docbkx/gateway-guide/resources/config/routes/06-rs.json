{
    "heap": {
        "objects": [
            {
                "name": "ResourceServerChain",
                "type": "Chain",
                "config": {
                    "filters": [
                        {
                            "type": "OAuth2ResourceServerFilter",
                            "config": {
                                "providerHandler": "ClientHandler",
                                "scopes": [
                                    "mail",
                                    "employeenumber"
                                ],
                                "tokenInfoEndpoint":
                                  "http://openam.example.com:8088/openam/oauth2/tokeninfo",
                                "requireHttps": false,
                                "target": "${exchange.token}"
                            }
                        },
                        {
                            "type": "ScriptableFilter",
                            "config": {
                                "type": "application/x-groovy",
                                "source":
                                  "import org.forgerock.json.fluent.JsonValue;
                                   logger.info(exchange.token.asJsonValue() as String);
                                   exchange.username = exchange.token.info.mail;
                                   exchange.password = exchange.token.info.employeenumber;
                                   next.handle(exchange)"
                            }
                        },
                        {
                            "type": "StaticRequestFilter",
                            "config": {
                                "method": "POST",
                                "uri": "http://www.example.com:8081",
                                "form": {
                                    "username": [
                                        "${exchange.username}"
                                    ],
                                    "password": [
                                        "${exchange.password}"
                                    ]
                                }
                            }
                        }
                    ],
                    "handler": "ClientHandler"
                }
            }
        ]
    },
    "handler": "ResourceServerChain",
    "condition": "${matches(exchange.request.uri.path, '^/rs')}"
}
