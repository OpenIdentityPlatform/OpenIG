<?xml version="1.0" encoding="UTF-8"?>
<!--
  ! CCPL HEADER START
  !
  ! This work is licensed under the Creative Commons
  ! Attribution-NonCommercial-NoDerivs 3.0 Unported License.
  ! To view a copy of this license, visit
  ! http://creativecommons.org/licenses/by-nc-nd/3.0/
  ! or send a letter to Creative Commons, 444 Castro Street,
  ! Suite 900, Mountain View, California, 94041, USA.
  !
  ! You can also obtain a copy of the license at legal/CC-BY-NC-ND.txt.
  ! See the License for the specific language governing permissions
  ! and limitations under the License.
  !
  ! If applicable, add the following below this CCPL HEADER, with the fields
  ! enclosed by brackets "[]" replaced with your own identifying information:
  !      Portions Copyright [yyyy] [name of copyright owner]
  !
  ! CCPL HEADER END
  !
  !      Copyright 2012-2015 ForgeRock AS.
  !    
-->
<chapter xml:id='chap-compatibility'
         xmlns='http://docbook.org/ns/docbook' version='5.0' xml:lang='en'
         xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'
         xsi:schemaLocation='http://docbook.org/ns/docbook
                             http://docbook.org/xml/5.0/xsd/docbook.xsd'
         xmlns:xlink='http://www.w3.org/1999/xlink'>
 <title>Changes &amp; Deprecated Functionality</title>

 <para>
  This chapter covers both major changes to existing functionality,
  and also deprecated and removed functionality.
 </para>

 <section xml:id="changes">
  <title>Important Changes to Existing Functionality</title>

<!--
  <para>
   This release brings the following changes to ${projectName}.
  </para>
-->

  <para>
   TODO: Update for the next release
  </para>

  <itemizedlist>
   <listitem>
    <para>
     The Route and GatewayHttpApplication configurations now use "baseURI" decorators
     instead of "baseURI" configuration fields.
    </para>
   </listitem>

   <listitem>
    <para>
     This release introduces an independent "OAuth2Provider" configuration object.
     The "OAuth2ClientFilter" configuration "providers" field
     now takes an array of "OAuth2Provider" object names or inline declarations.
     The "OAuth2ClientFilter" configuration "providerHandler" field
     is now part of the "OAuth2Provider" configuration.
    </para>

    <para>
     Previous configurations cause errors and prevent the route from loading
     when ${projectName} reads the configuration.
    </para>

    <programlisting language="none">
------------------------------
WED MAR 11 08:38:32 CET 2015 (ERROR) {Router}/handler
The route defined in file '/home/user/.openig/config/routes/07-openid.json
 cannot be added
------------------------------
WED MAR 11 08:38:32 CET 2015 (ERROR) {Router}/handler
/handler/config/filters/0/config/providers/0/type: Expecting a value
[       JsonValueException] > /handler/config/filters/0/config/providers/0/type:
 Expecting a value
    </programlisting>
   </listitem>

   <listitem>
    <para>
     The classes mentioned in <xref linkend="changed-classnames" />
     have changed names or changed packages.
    </para>
   </listitem>
  </itemizedlist>

  <table xml:id="changed-classnames">
   <title>Class Changes</title>

   <tgroup cols="2">
    <colspec colnum="1" colwidth="1*"/>
    <colspec colnum="2" colwidth="1*"/>

    <thead>
     <row>
      <entry>
       Former Name
      </entry>

      <entry>
       Current Name
      </entry>
     </row>
    </thead>

    <tbody>
     <row>
      <entry>
       <literal>org.forgerock.openig.jwt.JwtSessionFactory</literal>
      </entry>

      <entry>
       <literal>org.forgerock.openig.jwt.JwtSessionManager</literal>
      </entry>
     </row>

     <row>
      <entry>
       <literal>org.forgerock.openig.http.ClientInfo</literal>
      </entry>

      <entry>
       <literal>org.forgerock.http.ClientInfo</literal>
      </entry>
     </row>

     <row>
      <entry>
       <literal>org.forgerock.openig.http.Request</literal>
      </entry>

      <entry>
       <literal>org.forgerock.http.protocol.Request</literal>
      </entry>
     </row>

     <row>
      <entry>
       <literal>org.forgerock.openig.http.Response</literal>
      </entry>

      <entry>
       <literal>org.forgerock.http.protocol.Response</literal>
      </entry>
     </row>

     <row>
      <entry>
       <literal>org.forgerock.openig.servlet.GatewayServlet</literal>
      </entry>

      <entry>
       <literal>org.forgerock.openig.http.GatewayHttpApplication</literal>
      </entry>
     </row>

     <row>
      <entry>
       <literal>org.forgerock.openig.util.MutableUri</literal>
      </entry>

      <entry>
       <literal>org.forgerock.http.MutableUri</literal>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </table>
 </section>

 <section xml:id="deprecated">
  <title>Deprecated Functionality</title>

  <para>
   TODO: Update for the next release
  </para>

  <para>
   Deprecation is defined in the
   <link
    xlink:show="new"
    xlink:href="reference#reference"
    xlink:role="http://docbook.org/xlink/role/olink"
   ><citetitle>Reference</citetitle></link>
   appendix on
   <link
    xlink:show="new"
    xlink:href="reference#interface-stability"
    xlink:role="http://docbook.org/xlink/role/olink"
   ><citetitle>ForgeRock Product Interface Stability</citetitle></link>.
  </para>

  <table xml:id="deprecated-configuration">
   <title>Configuration settings</title>

   <tgroup cols="3">
    <colspec colnum="1" colwidth="1*"/>
    <colspec colnum="2" colwidth="1*"/>
    <colspec colnum="3" colwidth="1*"/>

    <thead>
     <row>
      <entry>
       Configuration Object
      </entry>

      <entry>
       <link
        xlink:show="new"
        xlink:href="reference#interface-stability"
        xlink:role="http://docbook.org/xlink/role/olink"
       >Deprecated</link> Settings
      </entry>

      <entry>
       Newer
       <link
        xlink:show="new"
        xlink:href="reference#interface-stability"
        xlink:role="http://docbook.org/xlink/role/olink"
       >Evolving</link> Settings
      </entry>
     </row>
    </thead>

    <tbody>
     <row>
      <entry morerows="1">
       <link
        xlink:show="new"
        xlink:href="reference#GatewayHttpApplication"
        xlink:role="http://docbook.org/xlink/role/olink"
       >GatewayHttpApplication</link>
      </entry>

      <entry>
       "handlerObject"
      </entry>

      <entry>
       New name: "handler"
      </entry>
     </row>

     <row>
      <entry>
       Deprecated format:
       <literal>"heap": { "objects": [ configuration object, ... ] }</literal>
      </entry>

      <entry>
       New format:
       <literal>"heap": [ configuration object, ... ]</literal>
      </entry>
     </row>

     <row>
      <entry morerows="1">
       <link
        xlink:show="new"
        xlink:href="reference#HttpClient"
        xlink:role="http://docbook.org/xlink/role/olink"
       >HttpClient</link>
      </entry>

      <entry>
       "keystore"
      </entry>

      <entry>
       Replaced by "keyManager", which takes one or more
       <link
        xlink:show="new"
        xlink:href="reference#KeyManager"
        xlink:role="http://docbook.org/xlink/role/olink"
       >KeyManager</link> references
      </entry>
     </row>

     <row>
      <entry>
       "truststore"
      </entry>

      <entry>
       Replaced by "trustManager", which takes one or more
       <link
        xlink:show="new"
        xlink:href="reference#TrustManager"
        xlink:role="http://docbook.org/xlink/role/olink"
       >TrustManager</link> references
      </entry>
     </row>

     <row>
      <entry morerows="2">
       <link
        xlink:show="new"
        xlink:href="reference#OAuth2ResourceServerFilter"
        xlink:role="http://docbook.org/xlink/role/olink"
        >OAuth2ResourceServerFilter</link>
      </entry>

      <entry>
       "enforceHttps"
      </entry>

      <entry>
       New name: "requireHttps"
      </entry>
     </row>

     <row>
      <entry>
       "httpHandler"
      </entry>

      <entry>
       New name: "providerHandler"
      </entry>
     </row>

     <row>
      <entry>
       "requiredScopes"
      </entry>

      <entry>
       New name: "scopes"
      </entry>
     </row>

     <row>
      <entry>
       RedirectFilter
      </entry>

      <entry>
       Entire object
      </entry>

      <entry>
       Use <link
        xlink:href="reference#LocationHeaderFilter"
        xlink:role="http://docbook.org/xlink/role/olink"
        xlink:show="new"
       >LocationHeaderFilter</link> instead
      </entry>
     </row>

     <row>
      <entry>
       <link
        xlink:show="new"
        xlink:href="reference#Route"
        xlink:role="http://docbook.org/xlink/role/olink"
       >Route</link>
      </entry>

      <entry>
       Deprecated format:
       <literal>"heap": { "objects": [ configuration object, ... ] }</literal>
      </entry>

      <entry>
       New format:
       <literal>"heap": [ configuration object, ... ]</literal>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </table>

  <itemizedlist>
   <para>
    The following API interfaces and classes
    are likely to be removed in a future release.
   </para>

   <listitem>
    <para>
     <link
      xlink:href="${javadocBase}/index.html?org/forgerock/openig/filter/Filter.html"
      xlink:show="new"
     >org.forgerock.openig.filter.Filter</link>
    </para>

    <para>
     The new interface to implement is
     <link
      xlink:href="${javadocBase}/index.html?org/forgerock/http/Filter.html"
      xlink:show="new"
     >org.forgerock.http.Filter</link>.
    </para>
   </listitem>

   <listitem>
    <para>
     <link
      xlink:href="${javadocBase}/index.html?org/forgerock/openig/handler/Handler.html"
      xlink:show="new"
     >org.forgerock.openig.handler.Handler</link>
    </para>

    <para>
     The new interface to implement is
     <link
      xlink:href="${javadocBase}/index.html?org/forgerock/http/Handler.html"
      xlink:show="new"
     >org.forgerock.http.Handler</link>.
    </para>
   </listitem>

   <listitem>
    <para>
     <link
      xlink:href="${javadocBase}/index.html?org/forgerock/openig/heap/NestedHeaplet.html"
      xlink:show="new"
     >org.forgerock.openig.heap.NestedHeaplet</link>
    </para>
   </listitem>
  </itemizedlist>

  <!--
  <para>
   No functionality is deprecated in this release.
  </para>
  -->
 </section>

 <section xml:id="removed">
  <title>Removed Functionality</title>

  <para>
   TODO: Update for the next release
  </para>

  <itemizedlist>
   <listitem>
    <para>
     The CaptureFilter implementation has been removed.
     Use a
     <link
      xlink:show="new"
      xlink:href="reference#CaptureDecorator"
      xlink:role="http://docbook.org/xlink/role/olink"
      >CaptureDecorator</link> instead.
    </para>
   </listitem>

   <listitem>
    <para>
     The GatewayServlet implementation has been replaced
     with <literal>org.forgerock.http.servlet.HttpFrameworkServlet</literal>,
     which wraps an HttpApplication that is provided by
     <literal>org.forgerock.openig.http.GatewayHttpApplication</literal>.
     The GatewayHttpApplication creates the heap and builds the configuration.
    </para>
   </listitem>

   <listitem>
    <para>
     The HttpClient hostnameVerifier configuration value
     <literal>BROWSER_COMPATIBLE</literal> has been removed.
     Consider using <literal>STRICT</literal> instead.
    </para>
   </listitem>
  </itemizedlist>
 </section>
</chapter>
